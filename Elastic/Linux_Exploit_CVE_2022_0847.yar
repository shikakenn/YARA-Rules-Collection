rule Linux_Exploit_CVE_2022_0847_e831c285 {
    meta:
        id = "4dYkc9MNWwydcW2HQ8sfa5"
        fingerprint = "v1_sha256_e15daf5de9bf66060e373a6e772669eade543ed56bef6b6924a0ee44e59522e1"
        version = "1.0"
        date = "2022-03-10"
        modified = "2022-03-14"
        status = "RELEASED"
        sharing = "TLP:WHITE"
        source = "YARA-RULES-COLLECTION"
        author = "Elastic Security"
        description = "NA"
        category = "INFO"
        threat_name = "Linux.Exploit.CVE-2022-0847"
        reference_sample = "c6b2cef2f2bc04e3ae33e0d368eb39eb5ea38d1bca390df47f7096117c1aecca"
        severity = 100
        arch_context = "x86"
        scan_context = "file, memory"
        license = "Elastic License v2"
        os = "linux"

    strings:
        $pp = "prepare_pipe"
        $s1 = "splice failed"
        $s2 = "short splice"
        $s3 = "short write"
        $s4 = "hijacking suid binary"
        $s5 = "Usage: %s TARGETFILE OFFSET DATA"
        $s6 = "Usage: %s SUID"
        $bs1 = { B8 00 10 00 00 81 7D EC 00 10 00 00 0F 46 45 EC 89 45 FC 8B 55 FC 48 8B 45 D8 48 83 C0 04 8B 00 48 8D 35 }
        $bs2 = { B8 00 10 00 00 81 7D F0 00 10 00 00 0F 46 45 F0 89 45 F8 8B 55 F8 48 8B 45 D8 8B 00 48 }
    condition:
        ($pp and 2 of ($s*)) or (all of ($bs*))
}

