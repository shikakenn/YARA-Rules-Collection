/*
    Yara Rule Set
    Author: Florian Roth
    Date: 2015-05-14
    Identifier: APT17
*/

/* Rule Set ----------------------------------------------------------------- */

rule APT17_Sample_FXSST_DLL {
    meta:
        id = "44fRY3ZrweFIJ66xTboILu"
        fingerprint = "v1_sha256_51d6da6c3ec46dc9e991a6a36de6d79626f1859296cda65e9027951c13aa4cd5"
        version = "1.0"
        date = "2015-05-14"
        modified = "2025-03-10"
        status = "RELEASED"
        sharing = "TLP:WHITE"
        source = "YARA-RULES-COLLECTION"
        author = "Florian Roth"
        description = "Detects Samples related to APT17 activity - file FXSST.DLL"
        category = "INFO"
        reference = "https://goo.gl/ZiJyQv"
        hash = "52f1add5ad28dc30f68afda5d41b354533d8bce3"

    strings:
        $x1 = "Microsoft? Windows? Operating System" fullword wide
        $x2 = "fxsst.dll" fullword ascii
        
        $y1 = "DllRegisterServer" fullword ascii
        $y2 = ".cSV" fullword ascii

        $s1 = "GetLastActivePopup"
        $s2 = "Sleep"
        $s3 = "GetModuleFileName"
        $s4 = "VirtualProtect"
        $s5 = "HeapAlloc"
        $s6 = "GetProcessHeap"
        $s7 = "GetCommandLine"
    condition:
        uint16(0) == 0x5a4d and filesize < 800KB and
            ( all of ($x*) or all of ($y*) ) and all of ($s*)
}
